@{
    ViewData["Title"] = "exam login";
    Layout = "~/Views/Shared/_Layoutscore.cshtml";
}


<style>
    .left {
        width: 25% !important;
        margin-right: 30px;
        display: inline-block;
        vertical-align: middle;
        float: none;
        text-align: left;
    }

    .right {
        width: 70% !important;
        display: inline-block;
        float: none;
        text-align: left !important;
    }

        .right input {
            padding: 10px !important;
            width: 100%;
            !important
        }

    .login {
        border: 15px solid #063b6d;
        padding: 15px;
        box-shadow: rgb(99, 51, 3) 2px 2px 15px;
        clip: rect(0px auto auto 0px);
        background-color: white;
        height: 350px;
        margin-top: 10px;
        width: 100%;
        max-width: 650px;
        margin-left: auto;
        margin-right: auto;
    }

    @@media (max-width:767px) {
        .left {
            width: 100% !important;
            margin-right: 0px;
            display: block;
        }

        .login {
            height: 400px !important
        }
    }

    .swal-wide {
        max-width: 1050px;
        width:95%;
    }

    .swal-modal {
        width: 90%;
        max-width:1000px;
        opacity: 0;
        pointer-events: none;
        background-color: #fff;
        text-align: center;
        border-radius: 5px;
        position: static;
        margin: 20px auto;
        display: inline-block;
        vertical-align: middle;
        -webkit-transform: scale(1);
        transform: scale(1);
        -webkit-transform-origin: 50% 50%;
        transform-origin: 50% 50%;
        z-index: 10001;
        transition: opacity .2s, -webkit-transform .3s;
        transition: transform .3s, opacity .2s;
        transition: transform .3s, opacity .2s, -webkit-transform .3s;
    }

    * {
        box-sizing: border-box;
        -webkit-font-smoothing: antialiased;
    }


</style>
<link rel="stylesheet" href="~/css/style.css" type="text/css">

<form id="captureForm" asp-controller="Home" asp-action="CaptureImage" method="post">
<div class="wrapper">
    <input type="hidden" id="hdfExamId" value="@ViewBag.ExamId" />
    <input type="hidden" id="hdfUserId" value="@ViewBag.uid" />
    <input type="hidden" id="hdfUserName" value="@ViewBag.uname" />
        <input type="hidden" id="hdfaddress" value="" />
    <div class="tagline">Performance Report</div>
    <input type="hidden" id="hdfTitle" /> 
   


    <div class="performance">
        <div id="printdata">
            <p style="text-align:center">
                "रामचरितमानस प्रश्नोत्तरी – 2025" को सफलतापूर्वक पूर्ण करने के लिए आपका धन्यवाद।<br>
                Thank you for successfully completing “Ramcharitmanas Quiz – 2025”.
            </p>


            <div class="user-name" style="text-align:center">Welcome !  @ViewBag.uname,</div>
            <div class="perform-head" style="text-align:center"><span>परिणाम</span> <span>Result</span></div>
            <div id="divScoreContainer" style="padding: 10px 0px 10px 0px;">
            </div>
        </div>

        <div class="impo-note" id="notess">
            <p>कृपया ध्यान दें / Please Note</p>
            <ul>
                <li>आपने अपना पहला प्रयास सफलतापूर्वक पूरा कर लिया है।</li>
                <li>यदि आप दूसरा और अंतिम प्रयास अभी करना चाहते हैं, तो 'पुनः प्रयास' बटन पर क्लिक करें।</li>
                    <li>यदि आप इसे बाद में करना चाहते हैं, तो कृपया <strong>25 जुलाई 2025 (शुक्रवार)</strong> से पहले लॉगिन पेज पर जाकर अपना यूज़रनेम और पासवर्ड दर्ज करें और पुनः प्रयास करें।</li>
                <li>यदि आप पुनः प्रयास नहीं करना चाहते हैं, तो <strong>'डाउनलोड सर्टिफिकेट'</strong> बटन पर क्लिक करें।</li>
              @*   <li>ध्यान दें: एक बार प्रमाणपत्र डाउनलोड करने के बाद पुनः प्रयास की अनुमति नहीं होगी।</li> *@
                <li>इन दोनों प्रयासों में से जिसमें अधिक अंक प्राप्त होंगे, उसी को अंतिम मानकर गणना की जाएगी।</li>
            </ul>
        </div>

        <p style="text-align: center;">
            आप नीचे दिए गए लिंक से अपनी प्राप्तांक रिपोर्ट और प्रमाण पत्र डाउनलोड कर सकते हैं।<br>
            You can download your performance report and certificate from the provided link below.
        </p>

        <div class="brand-box" style="font-size: 16px; font-weight: bold;">

            <span style="display:inline-block; vertical-align: middle;">
                प्रिन्ट और डाउनलोड परफॉरमेंस<br>
                Print & Download Performance
            </span>

                <span class="down-icon" style="cursor:pointer;"><img src="/images/download-button.svg" id="aPrintDownloadPerforma"></span>
                <span class="down-icon" style="cursor:pointer;"><img src="/images/print.svg" onclick="printDiv()"></span>

            @*            <a href="#" id="aPrintDownloadPerforma">
                <span class="down-icon"><img src="/images/download-button.svg"  id="" ></span>
            </a> <a href="#" id="pinys" onclick="printDiv('printdata')"><span class="down-icon"><img src="/images/print.svg"></span></a> *@

        </div>

        <div class="brand-box" style="font-size: 16px; font-weight: bold;">

            <span style="display:inline-block; vertical-align: middle;">
                प्रिन्ट और डाउनलोड सर्टिफिकेट<br>
                Print & Download Certificate
                </span><a href="/Home/certificate/@ViewBag.ExamId" target="_blank" id="aPrintDownloadcer">
                <span class="down-icon"><img src="/images/download-button.svg"></span>
            <span class="down-icon"><img src="/images/print.svg"></span></a>

        </div>


       
            <div class="mock-btn tryagain" id="trymores"  style="margin-top: 20px;margin-bottom:20px"><a href="/Home/REStartExam/@ViewBag.ExamId">पुनः प्रयास करें / Try again</a></div>
       
        <br />
        <p>
                हमें इस ऑनलाइन क्विज़ के बारे में आपकी प्रतिक्रिया और सुझाव अपेक्षित हैं ।<br>
            We would love to hear your feedback and suggestion about this online quiz.
        </p>
        <div class="feedback">
            <textarea class="textarea" id="feedback" name="feedback" placeholder="Your Valuable Feedback"></textarea>
        </div>
        <div class="cont-btn"><a href="#" onclick="Sendcontactus();">Submit</a></div>
    </div>
</div>


    <div id="divPrintableContent" style="display: none;"></div>
<div>
   @*  <div id="divCertificate" class="certificate" style="margin-top:30px;">
        <img src="/images_ma/Jharkhand_Certificate.jpg" />
        <div class="certificate_cont" style="position:relative; transform: translate(-50%, -50%); left: 50%; top: -37%!important;">
            <div style="font:bold 28px arial; text-align:center; border:0px; background:none; width:100%; color:#c74e15;" id="txtName1" name="txtName1"></div>
            <div style="font:normal 14px arial; text-align:center; text-transform:none; height:30px; border:0px; background:none; width:72%; margin:0px auto; margin-top:7px; " id="txtaddress" name="txtaddress"></div>

        </div>
    </div> *@

        <div id="divCertificate1" style="position:relative; display:none;"><img src="/images/Certificate.jpg" style="width: 100%;" /><div class="certificate_cont" style="position:absolute; transform: translate(-50%, -50%); left: 50%; top: 60%">  <div style="font:bold 30px arial; text-align:center; border:0px; background:none; width:100%; color:#c74e15;" id="txtName1" name="txtName1"></div><div style="font:normal 16px arial; text-align:center; text-transform:none; height:30px; border:0px; background:none; width:100%; margin:0px auto; margin-top:7px; " id="txtaddress" name="txtaddress"></div> </div> </div>

    </div>

<input type="hidden" id="hfImageData" name="hfImageData" value="" />

</form>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

<link data-require="sweet-alert" data-semver="0.4.2" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css" />
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<script src="~/heroesgenerator-master/script.js"></script>
<script src="~/heroesgenerator-master/base64binary.js"></script>

<script type="text/javascript">
var addHtml1 = "";

</script>


<script type="text/javascript">
    $(document).ready(function () {
        var addHtml = "";

         var jdata = {
             uid: $('#hdfUserId').val(),examid: $("#hdfExamId").val(), type: 'getreport'
         }
            url_add = window.location.href;
            var data = url_add.split("://")
            var protocol = data[0];
            data = data[1].split("/");
            var domain = data[0];
            var menuname = data[1] + "/" + data[2];
            var encrp = "";
            var url_add = window.location.protocol + "//" + window.location.host + "/";
            var url = url_add + 'api/ApiServices/QuizApi';
       
        $.ajax({
            type: "POST",
            //url: "/Home/fngetreport",
            url: url,
            data: { jsonData: JSON.stringify(jdata) },
            //data: {uid: $('#hdfUserId').val(),examid: $("#hdfExamId").val()},
            dataType: "json",
            success: function (res) {
                // If using ASP.NET MVC/Core: use data directly
                console.log(res.Data)
                console.log(res)
                var data = res.Data;
              
                var totalQ = data[0].totalnoofq;
                var attempt = data[0].attemptq;
                var correct = data[0].correctans;
                var incorrect = parseInt(attempt) - parseInt(correct);
                var negative = incorrect * 0.33;
                var score = Math.round(((parseInt(correct) - negative) / parseInt(totalQ)) * 100, 2);
                if (score == "NaN") {
                    score = 0;
                }
              

                var totalQ1 = data[0].totalnoofq1;
                var attempt1 = data[0].attemptq1;
                var correct1 = data[0].correctans1;
                var ReFlag = parseInt(data[0].ReFlag);
                var incorrect1 = parseInt(attempt1) - parseInt(correct1);
                var negative1 = incorrect1 * 0.33;
                var score1 = Math.round(((parseInt(correct1) - negative1) / parseInt(totalQ1)) * 100, 2);
                if (score1 == "NaN")
                { 
                    score1 = 0;
                }

                  if(ReFlag==0){
                    $("#trymores").hide();
                }

                $('#hdfTitle').val(data[0].title);
                $('#hdfUserName').val(data[0].name);
                $('#txtName1').html(data[0].name);
                $('#txtaddress').html(data[0].address1);
                $('#hdfaddress').val(data[0].address1);
                var classss = "";
                var classss1 = "";
               
                if (score > score1) 
                { 
                     classss = "best-score";
                }
                else
                {
                    classss1 = "best-score";
                }
                if (score == score1) 
                {
                    classss1 = "best-score";
                    classss = "best-score";
                }


                    addHtml =
                    '<div class="table_cont"><table width="100%" border="0" class="table">' +
                    '<tr class="table_subhead"><th>Name<br />नाम</th>'+
                    '<th>No. of Attempts <br />प्रयासों की संख्या</th>' +
                     '<th>Total Questions <br />कुल प्रश्न</th>' +
                    '<th>Attempted<br />प्रयास किये</th><th>Correct<br />सही</th>' +
                    '<th>Incorrect<br />गलत</th><th>Performance<br />परिणाम</th></tr>' +
                    '<tr class='+classss+'><td>' + data[0].name + '</td><td>1st</td><td>' + totalQ + '</td><td>' + attempt + '</td>' +
                    '<td>' + correct + '</td><td>' + incorrect + '</td><td>' + score.toFixed(2) + '%</td></tr>';

                if (parseInt(totalQ1) > 0) {
                    addHtml += '<tr class='+classss1+'><td></td><td>2nd</td><td>' + totalQ1 + '</td><td>' + attempt1 + '</td>' +
                        '<td>' + correct1 + '</td><td>' + incorrect1 + '</td><td>' + score1.toFixed(2) + '%</td></tr>';

                    $("#trymores").hide();
                    $("#notess").hide();
                }

                addHtml += '</table></div>';

                addHtml1 = ' <div style="font-size: 24px;text-transform: uppercase;background: #f1f1f1;padding:15px 5px 15px 5px;line-height:25px;text-align:center; ">Performance Report</div> <p style="text-align:center">"रामचरितमानस प्रश्नोत्तरी – 2025" को सफलतापूर्वक पूर्ण करने के लिए आपका धन्यवाद।<br> Thank you for successfully completing “Ramcharitmanas Quiz – 2025”.</p>' +
                    '<div style="display:block;clear: both; width:100%;overflow:auto;margin:10px 0px 30px 0px; "><table width="100%" border="0" style="font-size: 16px;font-weight: bold;width:100 %;border-collapse: collapse;text-align:center;">' +
                    '<tr style="font-size: 16px;font-weight:bold;text-align:center;background:#ed3237;color:#fff;"><th>Name<br />नाम</th><th> No.of Attempts <br/> प्रयासों की संख्या </th><th>Total Questions <br /> कुल प्रश्न </th>' +
                    '<th>Attempted<br />प्रयास किये</th><th>Correct<br />सही</th>' +
                    '<th>Incorrect<br />गलत</th><th>Performance<br />परिणाम</th></tr>' +
                    '<tr><td style="padding: 10px 5px 10px 5px;border: 1px solid #ccc; ">' + data[0].name + '</td><td style="padding: 10px 5px 10px 5px;border: 1px solid #ccc; ">1st</td><td style="padding: 10px 5px 10px 5px;border: 1px solid #ccc; ">' + totalQ + '</td><td style="padding: 10px 5px 10px 5px;border: 1px solid #ccc; ">' + attempt + '</td>' +
                    '<td style="padding: 10px 5px 10px 5px;border: 1px solid #ccc; ">' + correct + '</td><td style="padding: 10px 5px 10px 5px;border: 1px solid #ccc; ">' + incorrect + '</td><td style="padding: 10px 5px 10px 5px;border: 1px solid #ccc; ">' + score.toFixed(2) + '%</td></tr>';

                if (parseInt(totalQ1) > 0) {
                    $(".tryagain").hide();
                    addHtml1 += '<tr><td style="padding: 10px 5px 10px 5px;border: 1px solid #ccc; "></td><td style="padding: 10px 5px 10px 5px;border: 1px solid #ccc; ">2nd</td><td style="padding: 10px 5px 10px 5px;border: 1px solid #ccc; ">' + totalQ1 + '</td><td style="padding: 10px 5px 10px 5px;border: 1px solid #ccc; ">' + attempt1 + '</td>' +
                        '<td style="padding: 10px 5px 10px 5px;border: 1px solid #ccc; ">' + correct1 + '</td><td style="padding: 10px 5px 10px 5px;border: 1px solid #ccc; ">' + incorrect1 + '</td><td style="padding: 10px 5px 10px 5px;border: 1px solid #ccc; ">' + score1.toFixed(2) + '%</td></tr> ';
                }


                addHtml1 += '</table></div> <button id="btnPrint" type="button" onclick="prindatapro();" class="btn_submit">Print</button><script> function prindatapro() { document.getElementById("btnPrint").style.display = "none"; window.print(); } </\script>';
               

                $('#divScoreContainer').html(addHtml);
            },
            error: function (ex) {
                alert('There seems to be something wrong! Try later.');
            }
        });
    });

 
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>



<script type="text/javascript" src="~/js/table2excel.js"></script>

<script type="text/javascript">
    $(function () {
        $("#aPrintDownloadPerforma").click(function () {
           
            $("#divScoreContainer").table2excel({
                filename: "Ramcharitmanas Quiz–2025.xls"
            });

            var jdata = {
             uid: $('#hdfUserId').val(),examid: $("#hdfExamId").val(), type: 'updatedown'
            }
            url_add = window.location.href;
            var data = url_add.split("://")
            var protocol = data[0];
            data = data[1].split("/");
            var domain = data[0];
            var menuname = data[1] + "/" + data[2];
            var encrp = "";
            var url_add = window.location.protocol + "//" + window.location.host + "/";
            var url = url_add + 'api/ApiServices/QuizApi';

        $.ajax({
            type: "POST",
            //url: "/Home/fngetreport",
            url: url,
            data: { jsonData: JSON.stringify(jdata) },
            //data: {uid: $('#hdfUserId').val(),examid: $("#hdfExamId").val()},
            dataType: "json",
            success: function (res) {
                
            },
             error: function (ex) {
                alert('There seems to be something wrong! Try later.');
            }
          });
        });
    });



    function printDiv() {


        const wins = window.open('', '_blank');

        wins.document.write(addHtml1);

        wins.document.close();

        wins.onload = function () {
            console.log("Print window is ready.");
            wins.focus();
            wins.print();

            setTimeout(() => {
                wins.close();
            }, 500);
        };

        
    }



    function Sendcontactus() {

        if ($("#feedback").val() != "") {

            $.ajax({
                type: "POST",
                url: "/Home/feedback",
                data: {
                    Name: $('#hdfUserName').val(),
                    Email: $('#hdfUserId').val(),
                    Query: $("#feedback").val()
                },
                dataType: "json",
                success: function (response) {
                    $("#feedback").val('');
                    let status = response.status;
                    let message = response.message;
                    if (message == 'ok') {

                        const els = document.createElement('div')
                        els.innerHTML = '<div>हमसे संपर्क करने के लिए धन्यवाद।.<br /><br />आपका संदेश हमें प्राप्त हो गया है, और यदि आपके पास कोई प्रश्न है तो हमारी टीम का कोई सदस्य आपसे संपर्क करेगा।</div>'
                        swal({
                            title: " ",
                            content: els,
                            icon: "success",
                            width: 300,
                            timer: 100000,
                        });
                    } else {

                        swal({
                            title: " ",
                            text: "There seems to be something wrong! Try later.",
                            icon: "error",
                            width: 300,
                            timer: 100000,
                        });

                    }
                },
                error: function (ex) {
                    swal({
                        title: " ",
                        text: "There seems to be something wrong! Try later.",
                        icon: "error",
                        width: 300,
                        timer: 100000,
                    });
                }
            });
        }
        else { 

            swal({
                title: " ",
                text: "Please enter your feedback.",
                icon: "error",
                width: 300,
                timer: 100000,
            });
        }
    }
</script>





